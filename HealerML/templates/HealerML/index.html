<!DOCTYPE html>
{% load static %}
<html>

<head>
  <title>系统治愈师 | System Healer</title>
  <!-- 引入Bootstrap 4 CSS文件 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <!-- 引入阿里巴巴图标库字体 -->
  <link rel="stylesheet" href="//at.alicdn.com/t/c/font_3503143_uzhty8chw6m.css">
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <link rel="icon" href="{% static 'img/icon.jpg' %}">
  <!-- echarts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
</head>

<body>
  <nav class="navbar navbar-expand-lg my-nav">
    <!-- <a class="navbar-brand" href="#">Logo</a> -->
    <img src="{% static 'img/icon.png' %}" class="my-logo">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li>
          <a class="my-link">首页</a>
        </li>
        <li>
          <a class="my-link">技术文档</a>
        </li>
        <li>
          <a class="my-link">算法描述</a>
        </li>
        <li class="nav-item active">
          <!-- <p class="my-title">系统治愈师 | System Healer<span class="sr-only">(current)</span></p> -->
        </li>
        <li>
          <!-- <p style="margin: 0; padding-top: 10px; padding-left: 30px; color: #0055af;">———基于机器学习的分布式系统故障诊断系统</p> -->
        </li>
      </ul>
    </div>
  </nav>
  <div class="container-fluid my-out">
    <div class="row">
      <!-- 右主要内容栏 -->
      <!-- <div class="col-md-6"></div> -->
      <main role="main" class="col-md-12 ml-sm-auto my-main">
        <div class="container">
          <div class="upload container row">
            <div class="row">
              <div class="col-md-6">
                <div class="my-left-main">
                  <!-- <h1 class="he
                    aler">SYSTEM HEALER</h1> -->
                  <img src="{% static 'img/left.png' %}" class="biglogo">
                  <h1 style="text-align: center; margin-top: 20px; font-weight: bold; font-size: 50px; color: #454545;">
                    系统故障诊断系统</h1>
                </div>
              </div>
              <div class="col-md-6">
                <div class="my-right-main" style="text-align: center;">
                  <!-- <h1 class="healer">SYSTEM HEALER</h1> -->
                  <img src="{% static 'img/icon.png' %}" class="biglogo">
                  <!-- tip begin -->
                  <!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">点我显示提示信息</button> -->
                  <img src="{% static 'img/bangzhu.png' %}" class="wenhao" data-toggle="modal" data-target="#myModal"
                    style="margin: 0 auto;">
                  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="myModalLabel">输入文件提示信息</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          <p>请上传.csv格式格式的数据 ！</p>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">好的</button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- tip end -->
                  {% comment %} <form method="post" enctype="multipart/form-data">
                    <div style="text-align: center;">
                      <input class="btn btn-primary"
                        style="margin-top: 10px; margin-bottom: 30px; background-color: #0f70e6; border-radius: 20px;"
                        type="file" name="data">
                      <br>
                      <button type="button submit" class="btn btn-primary my-btn"
                        onclick="showLoadingModal()">点击上传</button>
                    </div>
                  </form> {% endcomment %}

                  <form method="post" enctype="multipart/form-data">
                    <div style="text-align: center;">
                      <input class="btn btn-primary"
                        style="margin-top: 10px; margin-bottom: 30px; background-color: #0f70e6; border-radius: 20px;"
                        type="file" name="data" onchange="enableUploadButton()">
                      <br>
                      <button type="submit" class="btn btn-primary my-btn" id="uploadButton" disabled>点击上传</button>
                    </div>
                  </form>

                  <script>
                    // 在页面加载时禁用上传按钮
                    window.addEventListener('DOMContentLoaded', function() {
                      var uploadButton = document.getElementById('uploadButton');
                      uploadButton.disabled = true;
                    });
                  
                    // 在文件选择时启用上传按钮
                    function enableUploadButton() {
                      var uploadButton = document.getElementById('uploadButton');
                      uploadButton.disabled = false;
                    }
                  </script>

{#                  {% if train_loss %}#}
{#                  <hr>#}
{#                  <h5>Process Result :#}
{#                  </h5>#}
{#                  <a href="{{ download_link }}">Download processed data</a>#}
{#                  <br>#}
{#                  <a href="{{ model_download_link }}">Download Model</a>#}
{#                  {% endif %}#}
                    {% if model_download_link %}
                        <h5>Process Result :</h5>
                        <a href="{{ model_download_link }}">Download Model</a>
                        <br>
                    {% endif %}
                    {% if  download_link %}
                      <a href="{{ download_link }}">Download processed data</a>
                    {% endif %}
                  <!-- waiting begin -->
                  <div class="modal" id="loadingModal" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                      <div class="modal-content">
                        <div class="modal-body text-center" style="padding-top: 40px;">
                          <div class="spinner-border" role="status">
                            <span class="sr-only">Loading...</span>
                          </div>
                          <p style="padding-top: 20px;">正在训练模型并预测</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- waiting end -->
                </div>
              </div>
            </div>
          </div>
          <div class="figs-container">
            <!-- <h3 style="margin-top: 30px;">生成图片</h3>
            <p>以下是主要内容的部分。</p> -->
            <!-- fig begin -->
            <div class="row">
              <div class="col-md-6">
                <div id="pie chart" style="width: 600px; height: 400px;"></div>
              </div>
              {% if not label_counts %}
              <div class="col-md-6" style="text-align: center;">
                <p style="padding-top: 10px;">分类结果可视化</p>
                <img src="{% static 'img/image.png' %}" alt="图片3" class="img-fluid" style="width: 400px;">
              </div>
              {% endif %}

              {% if label_counts %}
              <div class="col-md-6" style="text-align: center;">
                <p style="padding-top: 10px;">图片说明</p>
                <img src="{{ uploads_path }}_tsne.png" alt="图片3" class="img-fluid" style="width: 400px;">
              </div>
              {% endif %}
            </div>

            <div class="" style="margin: 0 auto;">
              <div id="line chart"
                style="width: 800px; height: 400px; margin-top: 40px; margin-left: auto; margin-right: auto;"></div>
            </div>

          </div>
          <!-- fig end -->
        </div>
      </main>
    </div>
  </div>
  <footer class="my-footer">
    <!-- 底部栏内容 -->
    &copy; 2023 My Website. All rights reserved.
  </footer>
  <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
  <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>

  <!-- bootstrap.bundle.min.js 用于弹窗、提示、下拉菜单，包含了 popper.min.js -->
  <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>

  <!-- 最新的 Bootstrap4 核心 JavaScript 文件 -->
  <script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>



  <script>
    // 显示模态框
    function showLoadingModal() {
      $('#loadingModal').modal('show');
    }

    // 隐藏模态框
    function hideLoadingModal() {
      $('#loadingModal').modal('hide');
    }
  </script>

  <script src="{% static 'charts.js' %}"></script>

  {% if not label_counts %}
  <script>
    // < !--饼状图 begin-- >
    // 初始化 ECharts 实例
    var chart = echarts.init(document.getElementById('pie chart'));

    // 配置图表选项
    var option = {
      title: {
        text: '各类别所占比例',
        subtext: '数据来源',
        left: 'center'
      },
      tooltip: {
        trigger: 'item',
        formatter: '{a} <br/>{b} : {c} ({d}%)'
      },
      legend: {
        orient: 'vertical',
        left: 'left',
        data: ['类别0', '类别1', '类别2', '类别3', '类别4', '类别5']
      },
      series: [
        {
          name: '数据统计',
          type: 'pie',
          radius: '55%',
          center: ['50%', '60%'],
          data: [
            { value: 1, name: '类别0' },
            { value: 1, name: '类别1' },
            { value: 1, name: '类别2' },
            { value: 1, name: '类别3' },
            { value: 1, name: '类别4' },
            { value: 1, name: '类别5' }
          ],
          itemStyle: {
            emphasis: {
              shadowBlur: 10,
              shadowOffsetX: 0,
              shadowColor: 'rgba(0, 0, 0, 0.5)'
            }
          }
        }
      ]
    };

    // 使用配置项显示图表
    chart.setOption(option);
    // < !--饼状图 end-- >

    // 折线图 begin
    // 初始化 ECharts 实例
    var chart = echarts.init(document.getElementById('line chart'));
    // 配置图表选项
    var option = {
      title: {
        text: '训练集 | 验证集Loss',
        left: 'center',
      },
      tooltip: {
        trigger: 'axis'
      },
      legend: {
        data: ['训练集Loss', '验证集Loss'],
        left: '10%',
        top: '7%'
      },
      xAxis: {
        type: 'category',
        data: ['1', '2', '3', '4', '5'],
        data: count,
        axisLabel: {
          interval: 0  // 强制显示所有标签
        }
      },
      yAxis: {
        type: 'value'
      },
      series: [
        {
          name: '训练集Loss',
          type: 'line',
          data: [10, 8, 6, 4, 2]
        },
        {
          name: '验证集Loss',
          type: 'line',
          data: [9, 7, 5, 3, 1]
        }
      ]
    };

    // 使用配置项显示图表
    chart.setOption(option);
// 折线图 end
  </script>
  {% endif %}

  {% if label_counts %}
  <script>
    // < !--饼状图 begin-- >
    // 初始化 ECharts 实例
    var chart = echarts.init(document.getElementById('pie chart'));
    var label_counts = JSON.parse('{{ label_counts|escapejs }}');

    // 配置图表选项
    var option = {
      title: {
        text: '各类别所占比例',
        subtext: '数据来源',
        left: 'center'
      },
      tooltip: {
        trigger: 'item',
        formatter: '{a} <br/>{b} : {c} ({d}%)'
      },
      legend: {
        orient: 'vertical',
        left: 'left',
        data: ['类别0', '类别1', '类别2', '类别3', '类别4', '类别5']
      },
      series: [
        {
          name: '数据统计',
          type: 'pie',
          radius: '55%',
          center: ['50%', '60%'],
          data: [
            { value: label_counts[0], name: '类别0' },
            { value: label_counts[1], name: '类别1' },
            { value: label_counts[2], name: '类别2' },
            { value: label_counts[3], name: '类别3' },
            { value: label_counts[4], name: '类别4' },
             {value: label_counts[5], name: '类别5'}
          ],
          itemStyle: {
            emphasis: {
              shadowBlur: 10,
              shadowOffsetX: 0,
              shadowColor: 'rgba(0, 0, 0, 0.5)'
            }
          }
        }
      ]
    };

    // 使用配置项显示图表
    chart.setOption(option);
    // < !--饼状图 end-- >

    // 折线图 begin
    // 初始化 ECharts 实例
    var chart = echarts.init(document.getElementById('line chart'));
    // 配置图表选项
    var train_loss = JSON.parse('{{ train_loss|escapejs }}');
    var val_loss = JSON.parse('{{ val_loss|escapejs }}');
    var count = [];
    for (var i = 1; i <= train_loss.length; i++) {
      count.push(i);
    }

    var option = {
      title: {
        text: '训练集 | 验证集Loss',
        left: 'center',
      },
      tooltip: {
        trigger: 'axis'
      },
      legend: {
        data: ['训练集Loss', '验证集Loss'],
        left: '10%',
        top: '7%'
      },
      xAxis: {
        type: 'category',
        // data: ['A', 'B', 'C', 'D', 'E'],
        data: count,
        axisLabel: {
          interval: 0  // 强制显示所有标签
        }
      },
      yAxis: {
        type: 'value'
      },
      series: [
        {
          name: '训练集Loss',
          type: 'line',
          // data: [10, 20, 30, 40, 50]
          data: train_loss
        },
        {
          name: '验证集Loss',
          type: 'line',
          // data: [20, 40, 10, 50, 30]
          data: val_loss
        }
      ]
    };

    // 使用配置项显示图表
    chart.setOption(option);
// 折线图 end
  </script>
  {% endif %}

</body>

</html>